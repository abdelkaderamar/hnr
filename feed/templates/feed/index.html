{% extends 'base.html' %}

{% load static %}

{% block content %}

<div class='container'>
<select id='sort-stories-combobox' class="form-select" aria-label="Sorting" onchange="sortStories();">
    <option selected>Choose sort factor</option>
    <option value="score">Score</option>
    <option value="descendants">Comments</option>
    <option value="ratio">Ratio score/comments</option>
  </select>
</div>

<ul class="list-group">
{% for story in stories %}
<li class="list-group-item">
    <form style="float" method="post" 
        action="{% url 'feed:save' story.id %}" class="inline">
        {% csrf_token %}
        {% comment %} <input type="hidden" name="story_id" value="{{story.id}}"> {% endcomment %}
        <button type="submit" name="story_id" value="{{story.id}}" class="link-button">
            <img class="add-image" src="{% static 'images/add.png' %}"/>
        </button>
    </form>
    <span class="hn-score">{{story.score}}</span>
    <a class="hn-title" href="{{story.url}}">{{story.title}}</a>
    <a class="hn-comment" href="https://news.ycombinator.com/item?id={{story.id}}">{{story.descendants}} Comments</a>
</li>
{% endfor %}
</ul>

<!--Pagination-->
<nav aria-label="Page navigation example">
  <ul class="pagination justify-content-center">
  {% if stories.has_previous %}
  <li class="page-item">
  <a class="page-link" href="?page={{ stories.previous_page_number }}">Previous</a>
  </li>
  {% else %}
  <li class="page-item disabled">
  <a class="page-link" href="#" tabindex="-1" aria-disabled="True">Previous</a>
  </li>
  {% endif %}

  {% if stories.number|add:'-4' > 1 %}
  <li class="page-item"><a class="page-link" href="?page=1">1</a></li>
  <li class="page-item"><a class="page-link" href="?page={{ stories.number|add:'-5' }}">&hellip;</a></li>
  {% endif %}

  {% for i in stories.paginator.page_range %}
    {% if stories.number == i %}
    <li class="page-item active" aria-current="page">
      <span class="page-link">
      {{ i }}
      <span class="sr-only">(current)</span>
    </span>
    </li>
    {% elif i > stories.number|add:'-5' and i < stories.number|add:'5' %}
    <li class="page-item"><a class="page-link" href="?page={{ i }}">{{ i }}</a></li>
    {% endif %}
  {% endfor %}

  {% if stories.paginator.num_pages > stories.number|add:'4' %}
  <li class="page-item"><a class="page-link" href="?page={{ stories.number|add:'5' }}">&hellip;</a></li>
  <li class="page-item"><a class="page-link" href="?page={{ stories.paginator.num_pages }}">{{ stories.paginator.num_pages }}</a></li>
  {% endif %}

  {% if stories.has_next %}
  <li class="page-item">
  <a class="page-link" href="?page={{ stories.next_page_number }}">Next</a>
  </li>
  {% else %}
  <li class="page-item disabled">
  <a class="page-link" href="#" tabindex="-1" aria-disabled="True">Next</a>
  </li>
  {% endif %}
  </ul>
</nav>
<!--end of Pagination-->

<script type="text/javascript">
    function sortStories() {
        var sortComboBox = document.getElementById('sort-stories-combobox');
        var selectedValue = sortComboBox[sortComboBox.selectedIndex].value;
        console.log("Selected value " + selectedValue);
        switch (selectedValue) {
        case 'score':
        case 'descendants':
        case 'ratio':
            window.location = "/feed/sort/" + selectedValue;
            break;
        }
    }
</script>

{% endblock content %}