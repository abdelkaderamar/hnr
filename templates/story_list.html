{% extends 'base.html' %}

{% load static %}

{% block content %}

<div class="container-fluid">
  <div class="row">
    <div class="col-6">
  <select id='sort-stories-combobox' class="form-select sort-combo" aria-label="Sorting" onchange="sortStories();">
      <option selected>Choose sort factor</option>
      <option value="time">Time</option>
      <option value="score">Score</option>
      <option value="descendants">Comments</option>
      <option value="ratio">Ratio score/comments</option>
    </select>
  </div>
</div>
<div class="container-fluid">
<ul class="list-group">
{% for user_story in stories %}
{% if user_story.story.descendants > 10 or user_story.story.score > 10 %}
<li class="list-group-item highlighted-story-item">
{% else %}
<li class="list-group-item story-item">
{% endif %}
  <div class="row">
      <div class="col">
        <a class="hnr-a" href="{{user_story.story.url}}"><span class="hnr-title">{{user_story.story.title}}</span></a>
      </div>
  </div>
  <div class="row">
      <div class="col">
        <span class="hnr-score badge bg-primary">{{user_story.story.score}} p</span>
        <span class="hnr-comment badge bg-success">{{user_story.story.descendants}} c</span>
        {% if user.is_authenticated %}
        {% if not user_story.saved %}
        <form style="float" method="post" 
            action="{% url 'feed:save' user_story.story.id %}" class="form-icon">
            {% csrf_token %}
            <button type="submit" name="story_id" value="{{story.id}}" class="link-button">
              <i class="hnr-add-icon fa-solid fa-square-plus fa-xl"></i>
            </button>
        </form>
        {% else %}
        <form style="float" method="post" 
            action="{% url 'feed:delete' user_story.story.id %}" class="form-icon">
            {% csrf_token %}
            <button type="submit" name="story_id" value="{{story.id}}" class="link-button">
              <i class="hnr-del-icon fa-solid fa-square-minus fa-xl"></i>
            </button>
        </form>
        {% endif %}
        <form style="float" method="post" 
          action="{% url 'feed:hide' user_story.story.id %}" class="form-icon">
          {% csrf_token %}
          <button type="submit" name="story_id" value="{{story.id}}" class="link-button">
          {% if user_story.ignored %}
          <i class="hnr-show-icon fa-solid fa-eye fa-xl"></i>
          {% else %}
          <i class="hnr-hide-icon fa-solid fa-trash fa-xl"></i>
          {% endif %}
          </button>
        </form>
        {% endif %}
        <span class="hnr-comment">
          <a  href="https://news.ycombinator.com/item?id={{user_story.story.id}}">
          <i class="fa-solid fa-comments fa-xl"></i>
          </a>
        </span>
      </div>
  </div>
  </li>
{% endfor %}
</ul>

<!--Pagination-->
<nav aria-label="Page navigation example">
  <ul class="pagination justify-content-center">
  {% if stories.has_previous %}
  <li class="page-item">
  <a class="page-link" href="?page={{ stories.previous_page_number }}">Previous</a>
  </li>
  {% else %}
  <li class="page-item disabled">
  <a class="page-link" href="#" tabindex="-1" aria-disabled="True">Previous</a>
  </li>
  {% endif %}

  {% if stories.number|add:'-4' > 1 %}
  <li class="page-item"><a class="page-link" href="?page=1">1</a></li>
  <li class="page-item"><a class="page-link" href="?page={{ stories.number|add:'-5' }}">&hellip;</a></li>
  {% endif %}

  {% for i in stories.paginator.page_range %}
    {% if stories.number == i %}
    <li class="page-item active" aria-current="page">
      <span class="page-link">
      {{ i }}
      <span class="sr-only">(current)</span>
    </span>
    </li>
    {% elif i > stories.number|add:'-5' and i < stories.number|add:'5' %}
    <li class="page-item"><a class="page-link" href="?page={{ i }}">{{ i }}</a></li>
    {% endif %}
  {% endfor %}

  {% if stories.paginator.num_pages > stories.number|add:'4' %}
  <li class="page-item"><a class="page-link" href="?page={{ stories.number|add:'5' }}">&hellip;</a></li>
  <li class="page-item"><a class="page-link" href="?page={{ stories.paginator.num_pages }}">{{ stories.paginator.num_pages }}</a></li>
  {% endif %}

  {% if stories.has_next %}
  <li class="page-item">
  <a class="page-link" href="?page={{ stories.next_page_number }}">Next</a>
  </li>
  {% else %}
  <li class="page-item disabled">
  <a class="page-link" href="#" tabindex="-1" aria-disabled="True">Next</a>
  </li>
  {% endif %}
  </ul>
</nav>
<!--end of Pagination-->
</div>
</div>
<script type="text/javascript">
    function sortStories() {
        var sortComboBox = document.getElementById('sort-stories-combobox');
        var selectedValue = sortComboBox[sortComboBox.selectedIndex].value;
        console.log("Selected value " + selectedValue);
        switch (selectedValue) {
        case 'time':
        case 'score':
        case 'descendants':
        case 'ratio':
            const urlParams = new URLSearchParams(window.location.search);
            urlParams.set('sort_param', selectedValue);
            window.location.search = urlParams;
            break;
        }
    }
</script>

{% endblock content %}
